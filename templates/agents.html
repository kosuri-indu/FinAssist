<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Agents Center</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/overview.css') }}">
</head>

<body>
  {% include 'sidebar.html' %}

  <main class="main-content ml-72 p-8">
    <header class="mb-4">
      <h1 class="text-3xl font-extrabold text-gray-900">Agents Center</h1>
      <p class="text-sm text-gray-600">Manage and run your background agents. Click a card to see details or run an
        agent now.</p>
    </header>

        <section class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <!-- 1. Insight Analyst Agent (Green) -->
          <div class="border rounded-lg shadow p-4 bg-green-50 border-green-100 flex flex-col">
            <div class="flex items-start gap-3">
              <div class="h-12 w-12 rounded-md bg-green-100 flex items-center justify-center text-green-800 font-bold">IA</div>
              <div>
                <div class="text-lg font-semibold text-gray-800">Insight Analyst Agent</div>
                <div class="text-sm text-gray-600">Analyzes spending patterns and provides smart financial recommendations.</div>
              </div>
            </div>
            <div class="mt-3 overflow-auto max-h-96 text-sm text-gray-700 space-y-2">
              <div>
                <div class="font-semibold">Purpose</div>
                <div>The Insight Analyst Agent turns raw financial data into clear, actionable insights about spending patterns, recurring trends and overall financial health.</div>
              </div>
              <div>
                <div class="font-semibold">What It Does</div>
                <div class="mt-1">Analyzes transactions to surface top categories, spikes, trends and a simple health score with recommendations.</div>
              </div>
              <div>
                <div class="font-semibold">Where It Is Used</div>
                <div>Dashboard → AI Insights Panel; Agents Center (last run summary)</div>
              </div>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <div class="text-xs text-gray-500">Last Run: {{ last_runs.insights }}</div>
              <button class="px-3 py-1 bg-green-600 text-white rounded text-sm run-agent" data-agent="insights">Run</button>
            </div>
          </div>

          <!-- 2. Forecast Agent (Orange) -->
          <div class="border rounded-lg shadow p-4 bg-orange-50 border-orange-100 flex flex-col">
            <div class="flex items-start gap-3">
              <div class="h-12 w-12 rounded-md bg-orange-100 flex items-center justify-center text-orange-800 font-bold">F</div>
              <div>
                <div class="text-lg font-semibold text-gray-800">Forecast Agent</div>
                <div class="text-sm text-gray-600">Predicts next month's spending trends and budget forecasts.</div>
              </div>
            </div>
            <div class="mt-3 overflow-auto max-h-96 text-sm text-gray-700 space-y-2">
              <div>
                <div class="font-semibold">Purpose</div>
                <div>The Forecast Agent predicts next month’s expenses and category-wise spending to help users plan ahead.</div>
              </div>
              <div>
                <div class="font-semibold">What It Does</div>
                <div class="mt-1">Predicts next month's total and per-category spending and highlights likely increases or stress periods.</div>
              </div>
              <div>
                <div class="font-semibold">Where It Is Used</div>
                <div>Dashboard → Forecast Panel; Agents Center (preview of predictions)</div>
              </div>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <div class="text-xs text-gray-500">Last Run: {{ last_runs.forecast }}</div>
              <button class="px-3 py-1 bg-orange-600 text-white rounded text-sm run-agent" data-agent="forecast">Run</button>
            </div>
          </div>

          <!-- 3. Reminder Agent (Blue) -->
          <div class="border rounded-lg shadow p-4 bg-blue-50 border-blue-100 flex flex-col">
            <div class="flex items-start gap-3">
              <div class="h-12 w-12 rounded-md bg-blue-100 flex items-center justify-center text-blue-800 font-bold">R</div>
              <div>
                <div class="text-lg font-semibold text-gray-800">Reminder Agent</div>
                <div class="text-sm text-gray-600">Sends smart alerts for bills due and payment reminders.</div>
              </div>
            </div>
            <div class="mt-3 overflow-auto max-h-96 text-sm text-gray-700 space-y-2">
              <div>
                <div class="font-semibold">Purpose</div>
                <div>The Reminder Agent generates timely alerts for upcoming or overdue bills so users avoid late fees.</div>
              </div>
              <div>
                <div class="font-semibold">What It Does</div>
                <div class="mt-1">Monitors bills, computes upcoming due dates and creates notifications.</div>
              </div>
              <div>
                <div class="font-semibold">Where It Is Used</div>
                <div>Notifications Page; Dashboard → Upcoming Bills Panel; Agents Center (run status)</div>
              </div>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <div class="text-xs text-gray-500">Last Run: {{ last_runs.reminder }}</div>
              <button class="px-3 py-1 bg-blue-600 text-white rounded text-sm run-agent" data-agent="reminder">Run</button>
            </div>
          </div>

      <!-- 4. Chat Assistant Agent (Purple) -->
      <div class="border rounded-lg shadow p-4 bg-violet-50 border-violet-100 flex flex-col">
        <div class="flex items-start gap-3">
          <div class="h-12 w-12 rounded-md bg-violet-100 flex items-center justify-center text-violet-800 font-bold">C
          </div>
          <div>
            <div class="text-lg font-semibold text-gray-800">Chat Assistant Agent</div>
            <div class="text-sm text-gray-600">Provides a conversational interface for interacting with your finances.
            </div>
          </div>
        </div>
        <div class="mt-3 overflow-auto max-h-96 text-sm text-gray-700 space-y-2">
          <div>
            <div class="font-semibold">Purpose</div>
            <div>The Chat Agent provides a conversational interface to query finances, add transactions, and retrieve
              summaries.</div>
          </div>
          <div>
            <div class="font-semibold">What It Does</div>
            <div class="mt-1">Answers questions, retrieves summaries, and parses actions from natural language to create
              transactions.</div>
          </div>
          <div>
            <div class="font-semibold">Where It Is Used</div>
            <div>Chat Page; Agents Center (shows last run)</div>
          </div>
        </div>
        <div class="mt-3 flex items-center justify-between">
          <div class="text-xs text-gray-500">Last Run: {{ last_runs.chat }}</div>
          <button class="px-3 py-1 bg-violet-600 text-white rounded text-sm run-agent" data-agent="chat">Open
            Chat</button>
        </div>
      </div>

      <!-- 5. Investment Assistant (Teal) -->
      <div class="border rounded-lg shadow p-4 bg-teal-50 border-teal-100 flex flex-col">
        <div class="flex items-start gap-3">
          <div class="h-12 w-12 rounded-md bg-teal-100 flex items-center justify-center text-teal-800 font-bold">IA
          </div>
          <div>
            <div class="text-lg font-semibold text-gray-800">Investment Assistant</div>
            <div class="text-sm text-gray-600">Multi-agent assistant for portfolio summaries and investment advice.
            </div>
          </div>
        </div>
        <div class="mt-3 overflow-auto max-h-96 text-sm text-gray-700 space-y-2">
          <div>
            <div class="font-semibold">Purpose</div>
            <div>Provides portfolio summaries, risk assessments and action plans powered by AI and real-time financial
              data.
            </div>
          </div>
          <div>
            <div class="font-semibold">What It Does</div>
            <div class="mt-1">Summarizes holdings, fetches price history, and uses AI to generate personalized advice.
            </div>
          </div>
          <div>
            <div class="font-semibold">Where It Is Used</div>
            <div>The Investment page: /invest</div>
          </div>
        </div>
        <div class="mt-3 flex items-center justify-between">
          <div class="text-xs text-gray-500">Last Run: {{ last_runs.invest or 'never' }}</div>
          <!-- Changed to use nav-link class for consistent SPA navigation -->
          <a href="/invest"
            class="px-3 py-1 bg-teal-600 text-white rounded text-sm hover:bg-teal-700 transition-colors">Open</a>
        </div>
      </div>
    </section>
    <script>
      // Map agent keys to API endpoints or actions
      const agentEndpoint = {
        'insights': '/api/agents/insights/run',
        'forecast': '/api/agents/forecast/run',
        'reminder': '/api/agents/reminders/run'
      };

      function toast(msg) {
        const el = document.createElement('div');
        el.className = 'fixed bottom-6 right-6 bg-gray-900 text-white px-4 py-2 rounded shadow';
        el.textContent = msg;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 3000);
      }

      document.querySelectorAll('.run-agent').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const agent = btn.getAttribute('data-agent');
          if (agent === 'chat') {
            // chat opens chat page
            window.location.href = '/chat';
            return;
          }
          const ep = agentEndpoint[agent];
          if (!ep) { toast('No endpoint for agent'); return; }
          btn.disabled = true;
          btn.textContent = 'Running...';
          try {
            const res = await fetch(ep, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ force_ai: false }) });
            if (res.ok) {
              toast('Agent run completed. Refreshing...');
              setTimeout(() => location.reload(), 800);
            } else {
              const j = await res.json().catch(() => null);
              toast('Agent run failed: ' + (j && j.error ? j.error : res.status));
              btn.disabled = false;
              btn.textContent = 'Run';
            }
          } catch (err) {
            toast('Request failed: ' + err);
            btn.disabled = false;
            btn.textContent = 'Run';
          }
        });
      });
    </script>
    </div>
  </main>
</body>

</html>